<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 28 â€” TotWise Lab</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=DM+Sans:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/member_Day1/member.css">
    <script src="/auth/auth.js"></script>
    <!-- Soft Day-Locking -->
    <script src="/soft-day-lock.js"></script>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="brand">
                <svg class="brand-icon" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="16" cy="16" r="14" fill="#E8B4A0"/>
                    <circle cx="11" cy="13" r="2.5" fill="#2D3B3A"/>
                    <circle cx="21" cy="13" r="2.5" fill="#2D3B3A"/>
                    <path d="M11 21 Q16 26 21 21" stroke="#2D3B3A" stroke-width="2" stroke-linecap="round" fill="none"/>
                </svg>
                <div class="brand-text">
                    <span class="brand-name">TotWise Lab</span>
                    <span class="toolkit-label">2â€“3 Years Toolkit</span>
                </div>
            </div>
            <button class="logout-btn">Log out</button>
        </header>

        <main class="content">
            <section class="day-header-card">
                <div class="day-info">
                    <div class="info-item">
                        <svg class="info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 6v6l4 2"/>
                        </svg>
                        <span>5â€“10 minutes</span>
                    </div>
                    <div class="info-item">
                        <svg class="info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2a4 4 0 0 1 4 4c0 1.5-.8 2.8-2 3.5V11h-4V9.5A4 4 0 0 1 12 2z"/>
                            <path d="M8 14h8M9 18h6M10 22h4"/>
                        </svg>
                        <span>Week-4 Reflection</span>
                    </div>
                    <div class="info-item materials">
                        <svg class="info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                        </svg>
                        <span>None</span>
                    </div>
                </div>
            </section>

            <section class="activity-card">
                <div class="card-header">
                    <span class="card-emoji">ðŸ§¸</span>
                    <h2>Today's Activity: "Looking Back â€“ Week-4"</h2>
                </div>

                <div class="activity-section">
                    <h3>
                        <svg class="section-icon" viewBox="0 0 20 20" fill="currentColor">
                            <circle cx="10" cy="10" r="8" fill="#A8C5A0" opacity="0.2"/>
                            <path d="M10 6v8M6 10h8" stroke="#A8C5A0" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        How to Use
                    </h3>
                    <ul class="step-list">
                        <li>Read each statement quietly.</li>
                        <li>Notice patterns. No testing your child.</li>
                    </ul>
                </div>

                <div class="activity-section">
                    <h3>
                        <svg class="section-icon" viewBox="0 0 20 20" fill="currentColor">
                            <circle cx="10" cy="10" r="8" fill="#E8B4A0" opacity="0.2"/>
                            <path d="M7 10l2 2 4-4" stroke="#E8B4A0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Statements
                    </h3>
                    <ul class="step-list">
                        <li>My child chose</li>
                        <li>My child waited</li>
                        <li>My child explored</li>
                    </ul>
                </div>
            </section>

            <section class="script-card">
                <div class="card-header small">
                    <span class="card-emoji">ðŸ’¬</span>
                    <h3>Did your child do any of these this week?</h3>
                </div>
                
                <div class="situation">
                    <p class="situation-text" style="font-style: italic; color: #5A6B6A;">No answers required.</p>
                </div>

                <div style="padding: 20px 0;">
                    <ul class="step-list" style="list-style: none; padding-left: 0;">
                        <li style="padding: 12px 0; border-bottom: 1px solid #F0F7EF;">Chose</li>
                        <li style="padding: 12px 0; border-bottom: 1px solid #F0F7EF;">Waited</li>
                        <li style="padding: 12px 0; border-bottom: 1px solid #F0F7EF;">Explored</li>
                        <li style="padding: 12px 0; border-bottom: 1px solid #F0F7EF;">Tried</li>
                        <li style="padding: 12px 0;">Noticed</li>
                    </ul>
                </div>
            </section>

            <section class="emotional-card">
                <div class="card-header small">
                    <span class="card-emoji">ðŸ’›</span>
                    <h3>Parent Note</h3>
                </div>
                
                <div class="emotional-content">
                    <div class="emotional-text" style="text-align: center;">
                        <p style="font-size: 16px; line-height: 1.8; color: #2D3B3A;">You are supporting real growth.</p>
                    </div>
                </div>
            </section>

            <section class="reassurance-strip">
                <div class="reassurance-icon">
                    <svg viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M16 4 L18 12 L26 14 L18 16 L16 24 L14 16 L6 14 L14 12 Z" fill="#A8C5A0"/>
                        <circle cx="16" cy="14" r="3" fill="white"/>
                    </svg>
                </div>
                <div class="reassurance-text">
                    <p class="reassurance-title">Week-4 is about:</p>
                    <p class="reassurance-skills">Trusting the process.</p>
                </div>
            </section>

            <section class="completion-section">
                <button class="complete-btn" id="completeBtn">
                    <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                        <path d="M5 13l4 4L19 7"/>
                    </svg>
                    <span id="completeBtnText">Mark Today as Complete</span>
                </button>
            </section>
        </main>

        <div class="completion-overlay" id="completionOverlay">
            <div class="completion-modal">
                <div class="completion-celebration">
                    <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="50" cy="50" r="45" fill="#A8C5A0"/>
                        <path d="M30 50l12 12 28-28" stroke="white" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <h2>Lovely work this week!</h2>
                <p>You did something wonderful for your child.</p>
                <p class="completion-next">Day-29 will be ready when you are.</p>
                <button class="modal-close-btn" id="closeModalBtn">Done</button>
            </div>
        </div>
    </div>

    <script>
        (function() {
            if (typeof TotWiseAuth === 'undefined') {
                const token = sessionStorage.getItem('loginToken');
                if (!token) {
                    const protocol = window.location.protocol;
                    const pathname = window.location.pathname;
                    if (protocol === 'http:' || protocol === 'https:') {
                        const basePath = pathname.split('/member_Day')[0];
                        window.location.href = basePath + '/login/login.html';
                    } else {
                        window.location.href = '../login/login.html';
                    }
                    return;
                }
            } else {
                TotWiseAuth.initAuth({ checkURLToken: false, requireAuth: true });
            }
        })();

        function getCurrentDay() {
            const pathname = window.location.pathname;
            const match = pathname.match(/member-day(\d+)\.html/);
            return match ? parseInt(match[1]) : 28;
        }

        const currentDay = getCurrentDay();

        // Check and apply soft day-locking if needed
        if (typeof TotWiseSoftLock !== 'undefined') {
            TotWiseSoftLock.checkAndApply(currentDay);
        }
        const completeBtn = document.getElementById('completeBtn');
        const completionOverlay = document.getElementById('completionOverlay');
        const closeModalBtn = document.getElementById('closeModalBtn');

        completeBtn.addEventListener('click', function() {
            this.classList.add('completed');
            this.innerHTML = `<svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M5 13l4 4L19 7"/></svg><span>Completed</span>`;
            setTimeout(() => { completionOverlay.classList.add('show'); }, 300);
        });

        function handleCompletion() {
            completionOverlay.classList.remove('show');
            const completedDays = JSON.parse(localStorage.getItem('totwise.progress.completedDays') || '[]');
            if (!completedDays.includes(currentDay)) {
                completedDays.push(currentDay);
                localStorage.setItem('totwise.progress.completedDays', JSON.stringify(completedDays));
            }
            const protocol = window.location.protocol;
            const pathname = window.location.pathname;
            if (protocol === 'http:' || protocol === 'https:') {
                const basePath = pathname.split('/member_Day')[0];
                window.location.href = basePath + '/Dashboard/dashboard.html';
            } else {
                window.location.href = '../Dashboard/dashboard.html';
            }
        }

        closeModalBtn.addEventListener('click', handleCompletion);
        completionOverlay.addEventListener('click', function(e) {
            if (e.target === completionOverlay) handleCompletion();
        });

        const logoutBtn = document.querySelector('.logout-btn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function() {
                if (typeof TotWiseAuth !== 'undefined') {
                    TotWiseAuth.logout();
                } else {
                    sessionStorage.removeItem('loginToken');
                    sessionStorage.removeItem('userEmail');
                    const protocol = window.location.protocol;
                    const pathname = window.location.pathname;
                    if (protocol === 'http:' || protocol === 'https:') {
                        const basePath = pathname.split('/member_Day')[0];
                        window.location.href = basePath + '/login/login.html';
                    } else {
                        window.location.href = '../login/login.html';
                    }
                }
            });
        }
    </script>
</body>
</html>
