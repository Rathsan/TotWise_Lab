"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/auth/verify";
exports.ids = ["pages/api/auth/verify"];
exports.modules = {

/***/ "cookie":
/*!*************************!*\
  !*** external "cookie" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("cookie");

/***/ }),

/***/ "jsonwebtoken":
/*!*******************************!*\
  !*** external "jsonwebtoken" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("jsonwebtoken");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "@supabase/supabase-js":
/*!****************************************!*\
  !*** external "@supabase/supabase-js" ***!
  \****************************************/
/***/ ((module) => {

module.exports = import("@supabase/supabase-js");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth%2Fverify&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fauth%2Fverify.js&middlewareConfigBase64=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth%2Fverify&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fauth%2Fverify.js&middlewareConfigBase64=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_auth_verify_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/auth/verify.js */ \"(api)/./pages/api/auth/verify.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_auth_verify_js__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_auth_verify_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_auth_verify_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_auth_verify_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/auth/verify\",\n        pathname: \"/api/auth/verify\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_auth_verify_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmF1dGglMkZ2ZXJpZnkmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyUyRmFwaSUyRmF1dGglMkZ2ZXJpZnkuanMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDdUQ7QUFDdkQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLHNEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyxzREFBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQscUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90b3R3aXNlLXNlcnZlci8/NDMxNCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXMvYXBpL2F1dGgvdmVyaWZ5LmpzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsIFwiZGVmYXVsdFwiKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsIFwiY29uZmlnXCIpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5leHBvcnQgY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgUGFnZXNBUElSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuUEFHRVNfQVBJLFxuICAgICAgICBwYWdlOiBcIi9hcGkvYXV0aC92ZXJpZnlcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9hdXRoL3ZlcmlmeVwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth%2Fverify&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fauth%2Fverify.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/session.js":
/*!************************!*\
  !*** ./lib/session.js ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   clearSessionCookie: () => (/* binding */ clearSessionCookie),\n/* harmony export */   getSessionToken: () => (/* binding */ getSessionToken),\n/* harmony export */   setSessionCookie: () => (/* binding */ setSessionCookie),\n/* harmony export */   signSession: () => (/* binding */ signSession),\n/* harmony export */   verifySession: () => (/* binding */ verifySession)\n/* harmony export */ });\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jsonwebtoken */ \"jsonwebtoken\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var cookie__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! cookie */ \"cookie\");\n/* harmony import */ var cookie__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(cookie__WEBPACK_IMPORTED_MODULE_1__);\n\n\nconst SESSION_COOKIE = \"totwise_session\";\nconst SESSION_TTL_SECONDS = 60 * 60 * 24 * 45;\nconst SESSION_SECRET = process.env.SESSION_SECRET;\nif (!SESSION_SECRET) {\n    throw new Error(\"Missing SESSION_SECRET\");\n}\nfunction signSession(payload) {\n    return jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default().sign(payload, SESSION_SECRET, {\n        expiresIn: SESSION_TTL_SECONDS\n    });\n}\nfunction verifySession(token) {\n    return jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default().verify(token, SESSION_SECRET);\n}\nfunction setSessionCookie(res, token) {\n    const cookie = (0,cookie__WEBPACK_IMPORTED_MODULE_1__.serialize)(SESSION_COOKIE, token, {\n        httpOnly: true,\n        sameSite: \"lax\",\n        path: \"/\",\n        secure: \"development\" === \"production\",\n        maxAge: SESSION_TTL_SECONDS\n    });\n    res.setHeader(\"Set-Cookie\", cookie);\n}\nfunction clearSessionCookie(res) {\n    const cookie = (0,cookie__WEBPACK_IMPORTED_MODULE_1__.serialize)(SESSION_COOKIE, \"\", {\n        httpOnly: true,\n        sameSite: \"lax\",\n        path: \"/\",\n        secure: \"development\" === \"production\",\n        expires: new Date(0)\n    });\n    res.setHeader(\"Set-Cookie\", cookie);\n}\nfunction getSessionToken(req) {\n    if (req.cookies && req.cookies[SESSION_COOKIE]) {\n        return req.cookies[SESSION_COOKIE];\n    }\n    const header = req.headers.cookie || \"\";\n    const match = header.match(new RegExp(`${SESSION_COOKIE}=([^;]+)`));\n    return match ? match[1] : null;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvc2Vzc2lvbi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBK0I7QUFDSTtBQUVuQyxNQUFNRSxpQkFBaUI7QUFDdkIsTUFBTUMsc0JBQXNCLEtBQUssS0FBSyxLQUFLO0FBQzNDLE1BQU1DLGlCQUFpQkMsUUFBUUMsR0FBRyxDQUFDRixjQUFjO0FBRWpELElBQUksQ0FBQ0EsZ0JBQWdCO0lBQ25CLE1BQU0sSUFBSUcsTUFBTTtBQUNsQjtBQUVPLFNBQVNDLFlBQVlDLE9BQU87SUFDakMsT0FBT1Qsd0RBQVEsQ0FBQ1MsU0FBU0wsZ0JBQWdCO1FBQUVPLFdBQVdSO0lBQW9CO0FBQzVFO0FBRU8sU0FBU1MsY0FBY0MsS0FBSztJQUNqQyxPQUFPYiwwREFBVSxDQUFDYSxPQUFPVDtBQUMzQjtBQUVPLFNBQVNXLGlCQUFpQkMsR0FBRyxFQUFFSCxLQUFLO0lBQ3pDLE1BQU1JLFNBQVNoQixpREFBU0EsQ0FBQ0MsZ0JBQWdCVyxPQUFPO1FBQzlDSyxVQUFVO1FBQ1ZDLFVBQVU7UUFDVkMsTUFBTTtRQUNOQyxRQUFRaEIsa0JBQXlCO1FBQ2pDaUIsUUFBUW5CO0lBQ1Y7SUFDQWEsSUFBSU8sU0FBUyxDQUFDLGNBQWNOO0FBQzlCO0FBRU8sU0FBU08sbUJBQW1CUixHQUFHO0lBQ3BDLE1BQU1DLFNBQVNoQixpREFBU0EsQ0FBQ0MsZ0JBQWdCLElBQUk7UUFDM0NnQixVQUFVO1FBQ1ZDLFVBQVU7UUFDVkMsTUFBTTtRQUNOQyxRQUFRaEIsa0JBQXlCO1FBQ2pDb0IsU0FBUyxJQUFJQyxLQUFLO0lBQ3BCO0lBQ0FWLElBQUlPLFNBQVMsQ0FBQyxjQUFjTjtBQUM5QjtBQUVPLFNBQVNVLGdCQUFnQkMsR0FBRztJQUNqQyxJQUFJQSxJQUFJQyxPQUFPLElBQUlELElBQUlDLE9BQU8sQ0FBQzNCLGVBQWUsRUFBRTtRQUM5QyxPQUFPMEIsSUFBSUMsT0FBTyxDQUFDM0IsZUFBZTtJQUNwQztJQUNBLE1BQU00QixTQUFTRixJQUFJRyxPQUFPLENBQUNkLE1BQU0sSUFBSTtJQUNyQyxNQUFNZSxRQUFRRixPQUFPRSxLQUFLLENBQUMsSUFBSUMsT0FBTyxDQUFDLEVBQUUvQixlQUFlLFFBQVEsQ0FBQztJQUNqRSxPQUFPOEIsUUFBUUEsS0FBSyxDQUFDLEVBQUUsR0FBRztBQUM1QiIsInNvdXJjZXMiOlsid2VicGFjazovL3RvdHdpc2Utc2VydmVyLy4vbGliL3Nlc3Npb24uanM/ZmY5YyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgand0IGZyb20gJ2pzb253ZWJ0b2tlbic7XG5pbXBvcnQgeyBzZXJpYWxpemUgfSBmcm9tICdjb29raWUnO1xuXG5jb25zdCBTRVNTSU9OX0NPT0tJRSA9ICd0b3R3aXNlX3Nlc3Npb24nO1xuY29uc3QgU0VTU0lPTl9UVExfU0VDT05EUyA9IDYwICogNjAgKiAyNCAqIDQ1O1xuY29uc3QgU0VTU0lPTl9TRUNSRVQgPSBwcm9jZXNzLmVudi5TRVNTSU9OX1NFQ1JFVDtcblxuaWYgKCFTRVNTSU9OX1NFQ1JFVCkge1xuICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgU0VTU0lPTl9TRUNSRVQnKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNpZ25TZXNzaW9uKHBheWxvYWQpIHtcbiAgcmV0dXJuIGp3dC5zaWduKHBheWxvYWQsIFNFU1NJT05fU0VDUkVULCB7IGV4cGlyZXNJbjogU0VTU0lPTl9UVExfU0VDT05EUyB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZlcmlmeVNlc3Npb24odG9rZW4pIHtcbiAgcmV0dXJuIGp3dC52ZXJpZnkodG9rZW4sIFNFU1NJT05fU0VDUkVUKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldFNlc3Npb25Db29raWUocmVzLCB0b2tlbikge1xuICBjb25zdCBjb29raWUgPSBzZXJpYWxpemUoU0VTU0lPTl9DT09LSUUsIHRva2VuLCB7XG4gICAgaHR0cE9ubHk6IHRydWUsXG4gICAgc2FtZVNpdGU6ICdsYXgnLFxuICAgIHBhdGg6ICcvJyxcbiAgICBzZWN1cmU6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicsXG4gICAgbWF4QWdlOiBTRVNTSU9OX1RUTF9TRUNPTkRTXG4gIH0pO1xuICByZXMuc2V0SGVhZGVyKCdTZXQtQ29va2llJywgY29va2llKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNsZWFyU2Vzc2lvbkNvb2tpZShyZXMpIHtcbiAgY29uc3QgY29va2llID0gc2VyaWFsaXplKFNFU1NJT05fQ09PS0lFLCAnJywge1xuICAgIGh0dHBPbmx5OiB0cnVlLFxuICAgIHNhbWVTaXRlOiAnbGF4JyxcbiAgICBwYXRoOiAnLycsXG4gICAgc2VjdXJlOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nLFxuICAgIGV4cGlyZXM6IG5ldyBEYXRlKDApXG4gIH0pO1xuICByZXMuc2V0SGVhZGVyKCdTZXQtQ29va2llJywgY29va2llKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFNlc3Npb25Ub2tlbihyZXEpIHtcbiAgaWYgKHJlcS5jb29raWVzICYmIHJlcS5jb29raWVzW1NFU1NJT05fQ09PS0lFXSkge1xuICAgIHJldHVybiByZXEuY29va2llc1tTRVNTSU9OX0NPT0tJRV07XG4gIH1cbiAgY29uc3QgaGVhZGVyID0gcmVxLmhlYWRlcnMuY29va2llIHx8ICcnO1xuICBjb25zdCBtYXRjaCA9IGhlYWRlci5tYXRjaChuZXcgUmVnRXhwKGAke1NFU1NJT05fQ09PS0lFfT0oW147XSspYCkpO1xuICByZXR1cm4gbWF0Y2ggPyBtYXRjaFsxXSA6IG51bGw7XG59XG4iXSwibmFtZXMiOlsiand0Iiwic2VyaWFsaXplIiwiU0VTU0lPTl9DT09LSUUiLCJTRVNTSU9OX1RUTF9TRUNPTkRTIiwiU0VTU0lPTl9TRUNSRVQiLCJwcm9jZXNzIiwiZW52IiwiRXJyb3IiLCJzaWduU2Vzc2lvbiIsInBheWxvYWQiLCJzaWduIiwiZXhwaXJlc0luIiwidmVyaWZ5U2Vzc2lvbiIsInRva2VuIiwidmVyaWZ5Iiwic2V0U2Vzc2lvbkNvb2tpZSIsInJlcyIsImNvb2tpZSIsImh0dHBPbmx5Iiwic2FtZVNpdGUiLCJwYXRoIiwic2VjdXJlIiwibWF4QWdlIiwic2V0SGVhZGVyIiwiY2xlYXJTZXNzaW9uQ29va2llIiwiZXhwaXJlcyIsIkRhdGUiLCJnZXRTZXNzaW9uVG9rZW4iLCJyZXEiLCJjb29raWVzIiwiaGVhZGVyIiwiaGVhZGVycyIsIm1hdGNoIiwiUmVnRXhwIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/session.js\n");

/***/ }),

/***/ "(api)/./lib/subscription.js":
/*!*****************************!*\
  !*** ./lib/subscription.js ***!
  \*****************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ensureUser: () => (/* binding */ ensureUser),\n/* harmony export */   getActiveSubscription: () => (/* binding */ getActiveSubscription),\n/* harmony export */   getUserByEmail: () => (/* binding */ getUserByEmail),\n/* harmony export */   hasActiveSubscription: () => (/* binding */ hasActiveSubscription)\n/* harmony export */ });\n/* harmony import */ var _supabaseAdmin__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./supabaseAdmin */ \"(api)/./lib/supabaseAdmin.js\");\n/* harmony import */ var _validate__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./validate */ \"(api)/./lib/validate.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_supabaseAdmin__WEBPACK_IMPORTED_MODULE_0__]);\n_supabaseAdmin__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\nasync function getUserByEmail(email) {\n    const { data, error } = await _supabaseAdmin__WEBPACK_IMPORTED_MODULE_0__.supabaseAdmin.from(\"users\").select(\"*\").eq(\"email\", email).maybeSingle();\n    if (error) throw error;\n    return data;\n}\nasync function ensureUser(email) {\n    const existing = await getUserByEmail(email);\n    if (existing) return existing;\n    const { data, error } = await _supabaseAdmin__WEBPACK_IMPORTED_MODULE_0__.supabaseAdmin.from(\"users\").insert({\n        email\n    }).select(\"*\").single();\n    if (error) throw error;\n    return data;\n}\nasync function hasActiveSubscription(userId) {\n    const { data, error } = await _supabaseAdmin__WEBPACK_IMPORTED_MODULE_0__.supabaseAdmin.from(\"subscriptions\").select(\"id\").eq(\"user_id\", userId).eq(\"status\", \"ACTIVE\").eq(\"plan\", _validate__WEBPACK_IMPORTED_MODULE_1__.PLAN_ID).gt(\"expiry_date\", new Date().toISOString()).limit(1).maybeSingle();\n    if (error) throw error;\n    return !!data;\n}\nasync function getActiveSubscription(userId) {\n    const { data, error } = await _supabaseAdmin__WEBPACK_IMPORTED_MODULE_0__.supabaseAdmin.from(\"subscriptions\").select(\"*\").eq(\"user_id\", userId).eq(\"status\", \"ACTIVE\").eq(\"plan\", _validate__WEBPACK_IMPORTED_MODULE_1__.PLAN_ID).gt(\"expiry_date\", new Date().toISOString()).order(\"expiry_date\", {\n        ascending: false\n    }).limit(1).maybeSingle();\n    if (error) throw error;\n    return data || null;\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvc3Vic2NyaXB0aW9uLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFnRDtBQUNYO0FBRTlCLGVBQWVFLGVBQWVDLEtBQUs7SUFDeEMsTUFBTSxFQUFFQyxJQUFJLEVBQUVDLEtBQUssRUFBRSxHQUFHLE1BQU1MLHlEQUFhQSxDQUN4Q00sSUFBSSxDQUFDLFNBQ0xDLE1BQU0sQ0FBQyxLQUNQQyxFQUFFLENBQUMsU0FBU0wsT0FDWk0sV0FBVztJQUNkLElBQUlKLE9BQU8sTUFBTUE7SUFDakIsT0FBT0Q7QUFDVDtBQUVPLGVBQWVNLFdBQVdQLEtBQUs7SUFDcEMsTUFBTVEsV0FBVyxNQUFNVCxlQUFlQztJQUN0QyxJQUFJUSxVQUFVLE9BQU9BO0lBQ3JCLE1BQU0sRUFBRVAsSUFBSSxFQUFFQyxLQUFLLEVBQUUsR0FBRyxNQUFNTCx5REFBYUEsQ0FDeENNLElBQUksQ0FBQyxTQUNMTSxNQUFNLENBQUM7UUFBRVQ7SUFBTSxHQUNmSSxNQUFNLENBQUMsS0FDUE0sTUFBTTtJQUNULElBQUlSLE9BQU8sTUFBTUE7SUFDakIsT0FBT0Q7QUFDVDtBQUVPLGVBQWVVLHNCQUFzQkMsTUFBTTtJQUNoRCxNQUFNLEVBQUVYLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTUwseURBQWFBLENBQ3hDTSxJQUFJLENBQUMsaUJBQ0xDLE1BQU0sQ0FBQyxNQUNQQyxFQUFFLENBQUMsV0FBV08sUUFDZFAsRUFBRSxDQUFDLFVBQVUsVUFDYkEsRUFBRSxDQUFDLFFBQVFQLDhDQUFPQSxFQUNsQmUsRUFBRSxDQUFDLGVBQWUsSUFBSUMsT0FBT0MsV0FBVyxJQUN4Q0MsS0FBSyxDQUFDLEdBQ05WLFdBQVc7SUFDZCxJQUFJSixPQUFPLE1BQU1BO0lBQ2pCLE9BQU8sQ0FBQyxDQUFDRDtBQUNYO0FBRU8sZUFBZWdCLHNCQUFzQkwsTUFBTTtJQUNoRCxNQUFNLEVBQUVYLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTUwseURBQWFBLENBQ3hDTSxJQUFJLENBQUMsaUJBQ0xDLE1BQU0sQ0FBQyxLQUNQQyxFQUFFLENBQUMsV0FBV08sUUFDZFAsRUFBRSxDQUFDLFVBQVUsVUFDYkEsRUFBRSxDQUFDLFFBQVFQLDhDQUFPQSxFQUNsQmUsRUFBRSxDQUFDLGVBQWUsSUFBSUMsT0FBT0MsV0FBVyxJQUN4Q0csS0FBSyxDQUFDLGVBQWU7UUFBRUMsV0FBVztJQUFNLEdBQ3hDSCxLQUFLLENBQUMsR0FDTlYsV0FBVztJQUNkLElBQUlKLE9BQU8sTUFBTUE7SUFDakIsT0FBT0QsUUFBUTtBQUNqQiIsInNvdXJjZXMiOlsid2VicGFjazovL3RvdHdpc2Utc2VydmVyLy4vbGliL3N1YnNjcmlwdGlvbi5qcz9iNDQzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHN1cGFiYXNlQWRtaW4gfSBmcm9tICcuL3N1cGFiYXNlQWRtaW4nO1xuaW1wb3J0IHsgUExBTl9JRCB9IGZyb20gJy4vdmFsaWRhdGUnO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VXNlckJ5RW1haWwoZW1haWwpIHtcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxuICAgIC5mcm9tKCd1c2VycycpXG4gICAgLnNlbGVjdCgnKicpXG4gICAgLmVxKCdlbWFpbCcsIGVtYWlsKVxuICAgIC5tYXliZVNpbmdsZSgpO1xuICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xuICByZXR1cm4gZGF0YTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGVuc3VyZVVzZXIoZW1haWwpIHtcbiAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBnZXRVc2VyQnlFbWFpbChlbWFpbCk7XG4gIGlmIChleGlzdGluZykgcmV0dXJuIGV4aXN0aW5nO1xuICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgLmZyb20oJ3VzZXJzJylcbiAgICAuaW5zZXJ0KHsgZW1haWwgfSlcbiAgICAuc2VsZWN0KCcqJylcbiAgICAuc2luZ2xlKCk7XG4gIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XG4gIHJldHVybiBkYXRhO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFzQWN0aXZlU3Vic2NyaXB0aW9uKHVzZXJJZCkge1xuICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgLmZyb20oJ3N1YnNjcmlwdGlvbnMnKVxuICAgIC5zZWxlY3QoJ2lkJylcbiAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXG4gICAgLmVxKCdzdGF0dXMnLCAnQUNUSVZFJylcbiAgICAuZXEoJ3BsYW4nLCBQTEFOX0lEKVxuICAgIC5ndCgnZXhwaXJ5X2RhdGUnLCBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkpXG4gICAgLmxpbWl0KDEpXG4gICAgLm1heWJlU2luZ2xlKCk7XG4gIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XG4gIHJldHVybiAhIWRhdGE7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBY3RpdmVTdWJzY3JpcHRpb24odXNlcklkKSB7XG4gIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAuZnJvbSgnc3Vic2NyaXB0aW9ucycpXG4gICAgLnNlbGVjdCgnKicpXG4gICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKVxuICAgIC5lcSgnc3RhdHVzJywgJ0FDVElWRScpXG4gICAgLmVxKCdwbGFuJywgUExBTl9JRClcbiAgICAuZ3QoJ2V4cGlyeV9kYXRlJywgbmV3IERhdGUoKS50b0lTT1N0cmluZygpKVxuICAgIC5vcmRlcignZXhwaXJ5X2RhdGUnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcbiAgICAubGltaXQoMSlcbiAgICAubWF5YmVTaW5nbGUoKTtcbiAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcbiAgcmV0dXJuIGRhdGEgfHwgbnVsbDtcbn1cbiJdLCJuYW1lcyI6WyJzdXBhYmFzZUFkbWluIiwiUExBTl9JRCIsImdldFVzZXJCeUVtYWlsIiwiZW1haWwiLCJkYXRhIiwiZXJyb3IiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJtYXliZVNpbmdsZSIsImVuc3VyZVVzZXIiLCJleGlzdGluZyIsImluc2VydCIsInNpbmdsZSIsImhhc0FjdGl2ZVN1YnNjcmlwdGlvbiIsInVzZXJJZCIsImd0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwibGltaXQiLCJnZXRBY3RpdmVTdWJzY3JpcHRpb24iLCJvcmRlciIsImFzY2VuZGluZyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./lib/subscription.js\n");

/***/ }),

/***/ "(api)/./lib/supabaseAdmin.js":
/*!******************************!*\
  !*** ./lib/supabaseAdmin.js ***!
  \******************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   supabaseAdmin: () => (/* binding */ supabaseAdmin)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"@supabase/supabase-js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__]);\n_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nconst supabaseUrl = process.env.SUPABASE_URL;\nconst serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\nif (!supabaseUrl || !serviceRoleKey) {\n    throw new Error(\"Missing Supabase admin credentials\");\n}\nconst supabaseAdmin = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, serviceRoleKey, {\n    auth: {\n        persistSession: false,\n        autoRefreshToken: false\n    }\n});\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvc3VwYWJhc2VBZG1pbi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFxRDtBQUVyRCxNQUFNQyxjQUFjQyxRQUFRQyxHQUFHLENBQUNDLFlBQVk7QUFDNUMsTUFBTUMsaUJBQWlCSCxRQUFRQyxHQUFHLENBQUNHLHlCQUF5QjtBQUU1RCxJQUFJLENBQUNMLGVBQWUsQ0FBQ0ksZ0JBQWdCO0lBQ25DLE1BQU0sSUFBSUUsTUFBTTtBQUNsQjtBQUVPLE1BQU1DLGdCQUFnQlIsbUVBQVlBLENBQUNDLGFBQWFJLGdCQUFnQjtJQUNyRUksTUFBTTtRQUNKQyxnQkFBZ0I7UUFDaEJDLGtCQUFrQjtJQUNwQjtBQUNGLEdBQUciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90b3R3aXNlLXNlcnZlci8uL2xpYi9zdXBhYmFzZUFkbWluLmpzPzY2ZjEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJztcblxuY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9VUkw7XG5jb25zdCBzZXJ2aWNlUm9sZUtleSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVk7XG5cbmlmICghc3VwYWJhc2VVcmwgfHwgIXNlcnZpY2VSb2xlS2V5KSB7XG4gIHRocm93IG5ldyBFcnJvcignTWlzc2luZyBTdXBhYmFzZSBhZG1pbiBjcmVkZW50aWFscycpO1xufVxuXG5leHBvcnQgY29uc3Qgc3VwYWJhc2VBZG1pbiA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc2VydmljZVJvbGVLZXksIHtcbiAgYXV0aDoge1xuICAgIHBlcnNpc3RTZXNzaW9uOiBmYWxzZSxcbiAgICBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZVxuICB9XG59KTtcbiJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJzdXBhYmFzZVVybCIsInByb2Nlc3MiLCJlbnYiLCJTVVBBQkFTRV9VUkwiLCJzZXJ2aWNlUm9sZUtleSIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJFcnJvciIsInN1cGFiYXNlQWRtaW4iLCJhdXRoIiwicGVyc2lzdFNlc3Npb24iLCJhdXRvUmVmcmVzaFRva2VuIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/supabaseAdmin.js\n");

/***/ }),

/***/ "(api)/./lib/validate.js":
/*!*************************!*\
  !*** ./lib/validate.js ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PLAN_AMOUNT_INR: () => (/* binding */ PLAN_AMOUNT_INR),\n/* harmony export */   PLAN_AMOUNT_PAISE: () => (/* binding */ PLAN_AMOUNT_PAISE),\n/* harmony export */   PLAN_ID: () => (/* binding */ PLAN_ID),\n/* harmony export */   SUBSCRIPTION_DAYS: () => (/* binding */ SUBSCRIPTION_DAYS),\n/* harmony export */   isValidEmail: () => (/* binding */ isValidEmail)\n/* harmony export */ });\nconst PLAN_ID = \"age_2_3\";\nconst PLAN_AMOUNT_INR = 199;\nconst PLAN_AMOUNT_PAISE = PLAN_AMOUNT_INR * 100;\nconst SUBSCRIPTION_DAYS = 45;\nfunction isValidEmail(email) {\n    if (!email) return false;\n    return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(String(email).toLowerCase());\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvdmFsaWRhdGUuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBTyxNQUFNQSxVQUFVLFVBQVU7QUFDMUIsTUFBTUMsa0JBQWtCLElBQUk7QUFDNUIsTUFBTUMsb0JBQW9CRCxrQkFBa0IsSUFBSTtBQUNoRCxNQUFNRSxvQkFBb0IsR0FBRztBQUU3QixTQUFTQyxhQUFhQyxLQUFLO0lBQ2hDLElBQUksQ0FBQ0EsT0FBTyxPQUFPO0lBQ25CLE9BQU8sNkJBQTZCQyxJQUFJLENBQUNDLE9BQU9GLE9BQU9HLFdBQVc7QUFDcEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90b3R3aXNlLXNlcnZlci8uL2xpYi92YWxpZGF0ZS5qcz8wMDkwIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBQTEFOX0lEID0gJ2FnZV8yXzMnO1xuZXhwb3J0IGNvbnN0IFBMQU5fQU1PVU5UX0lOUiA9IDE5OTtcbmV4cG9ydCBjb25zdCBQTEFOX0FNT1VOVF9QQUlTRSA9IFBMQU5fQU1PVU5UX0lOUiAqIDEwMDtcbmV4cG9ydCBjb25zdCBTVUJTQ1JJUFRJT05fREFZUyA9IDQ1O1xuXG5leHBvcnQgZnVuY3Rpb24gaXNWYWxpZEVtYWlsKGVtYWlsKSB7XG4gIGlmICghZW1haWwpIHJldHVybiBmYWxzZTtcbiAgcmV0dXJuIC9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvLnRlc3QoU3RyaW5nKGVtYWlsKS50b0xvd2VyQ2FzZSgpKTtcbn1cbiJdLCJuYW1lcyI6WyJQTEFOX0lEIiwiUExBTl9BTU9VTlRfSU5SIiwiUExBTl9BTU9VTlRfUEFJU0UiLCJTVUJTQ1JJUFRJT05fREFZUyIsImlzVmFsaWRFbWFpbCIsImVtYWlsIiwidGVzdCIsIlN0cmluZyIsInRvTG93ZXJDYXNlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/validate.js\n");

/***/ }),

/***/ "(api)/./pages/api/auth/verify.js":
/*!**********************************!*\
  !*** ./pages/api/auth/verify.js ***!
  \**********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_supabaseAdmin__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/supabaseAdmin */ \"(api)/./lib/supabaseAdmin.js\");\n/* harmony import */ var _lib_subscription__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/subscription */ \"(api)/./lib/subscription.js\");\n/* harmony import */ var _lib_session__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/session */ \"(api)/./lib/session.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_supabaseAdmin__WEBPACK_IMPORTED_MODULE_0__, _lib_subscription__WEBPACK_IMPORTED_MODULE_1__]);\n([_lib_supabaseAdmin__WEBPACK_IMPORTED_MODULE_0__, _lib_subscription__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        res.setHeader(\"Allow\", \"POST\");\n        return res.status(405).json({\n            error: \"Method not allowed\"\n        });\n    }\n    const { token, email } = req.body || {};\n    if (!token || !email) {\n        return res.status(400).json({\n            error: \"Unable to sign in\"\n        });\n    }\n    try {\n        const user = await (0,_lib_subscription__WEBPACK_IMPORTED_MODULE_1__.getUserByEmail)(email);\n        if (!user) {\n            return res.status(401).json({\n                error: \"Unable to sign in\"\n            });\n        }\n        const { data: tokenRow, error: tokenError } = await _lib_supabaseAdmin__WEBPACK_IMPORTED_MODULE_0__.supabaseAdmin.from(\"auth_tokens\").select(\"*\").eq(\"token\", token).eq(\"user_id\", user.id).maybeSingle();\n        if (tokenError || !tokenRow) {\n            return res.status(401).json({\n                error: \"Unable to sign in\"\n            });\n        }\n        if (tokenRow.used) {\n            return res.status(401).json({\n                error: \"Unable to sign in\"\n            });\n        }\n        if (new Date(tokenRow.expires_at).getTime() < Date.now()) {\n            return res.status(401).json({\n                error: \"Unable to sign in\"\n            });\n        }\n        const activeSub = await (0,_lib_subscription__WEBPACK_IMPORTED_MODULE_1__.getActiveSubscription)(user.id);\n        if (!activeSub) {\n            return res.status(403).json({\n                error: \"Unable to sign in\"\n            });\n        }\n        const { error: updateTokenError } = await _lib_supabaseAdmin__WEBPACK_IMPORTED_MODULE_0__.supabaseAdmin.from(\"auth_tokens\").update({\n            used: true\n        }).eq(\"token\", token).eq(\"user_id\", user.id);\n        if (updateTokenError) {\n            console.error(\"[auth] token update error\", updateTokenError);\n        }\n        await _lib_supabaseAdmin__WEBPACK_IMPORTED_MODULE_0__.supabaseAdmin.from(\"users\").update({\n            last_login_at: new Date().toISOString()\n        }).eq(\"id\", user.id);\n        const sessionToken = (0,_lib_session__WEBPACK_IMPORTED_MODULE_2__.signSession)({\n            userId: user.id,\n            email: user.email\n        });\n        (0,_lib_session__WEBPACK_IMPORTED_MODULE_2__.setSessionCookie)(res, sessionToken);\n        return res.status(200).json({\n            success: true\n        });\n    } catch (error) {\n        console.error(\"[auth] verify error\", error);\n        return res.status(500).json({\n            error: \"Unable to sign in\"\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvYXV0aC92ZXJpZnkuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUEyRDtBQUN1QjtBQUNiO0FBRXRELGVBQWVLLFFBQVFDLEdBQUcsRUFBRUMsR0FBRztJQUM1QyxJQUFJRCxJQUFJRSxNQUFNLEtBQUssUUFBUTtRQUN6QkQsSUFBSUUsU0FBUyxDQUFDLFNBQVM7UUFDdkIsT0FBT0YsSUFBSUcsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQXFCO0lBQzVEO0lBRUEsTUFBTSxFQUFFQyxLQUFLLEVBQUVDLEtBQUssRUFBRSxHQUFHUixJQUFJUyxJQUFJLElBQUksQ0FBQztJQUN0QyxJQUFJLENBQUNGLFNBQVMsQ0FBQ0MsT0FBTztRQUNwQixPQUFPUCxJQUFJRyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBb0I7SUFDM0Q7SUFFQSxJQUFJO1FBQ0YsTUFBTUksT0FBTyxNQUFNZixpRUFBY0EsQ0FBQ2E7UUFDbEMsSUFBSSxDQUFDRSxNQUFNO1lBQ1QsT0FBT1QsSUFBSUcsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUFvQjtRQUMzRDtRQUVBLE1BQU0sRUFBRUssTUFBTUMsUUFBUSxFQUFFTixPQUFPTyxVQUFVLEVBQUUsR0FBRyxNQUFNbkIsNkRBQWFBLENBQzlEb0IsSUFBSSxDQUFDLGVBQ0xDLE1BQU0sQ0FBQyxLQUNQQyxFQUFFLENBQUMsU0FBU1QsT0FDWlMsRUFBRSxDQUFDLFdBQVdOLEtBQUtPLEVBQUUsRUFDckJDLFdBQVc7UUFFZCxJQUFJTCxjQUFjLENBQUNELFVBQVU7WUFDM0IsT0FBT1gsSUFBSUcsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUFvQjtRQUMzRDtRQUVBLElBQUlNLFNBQVNPLElBQUksRUFBRTtZQUNqQixPQUFPbEIsSUFBSUcsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUFvQjtRQUMzRDtRQUVBLElBQUksSUFBSWMsS0FBS1IsU0FBU1MsVUFBVSxFQUFFQyxPQUFPLEtBQUtGLEtBQUtHLEdBQUcsSUFBSTtZQUN4RCxPQUFPdEIsSUFBSUcsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUFvQjtRQUMzRDtRQUVBLE1BQU1rQixZQUFZLE1BQU01Qix3RUFBcUJBLENBQUNjLEtBQUtPLEVBQUU7UUFDckQsSUFBSSxDQUFDTyxXQUFXO1lBQ2QsT0FBT3ZCLElBQUlHLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQUVDLE9BQU87WUFBb0I7UUFDM0Q7UUFFQSxNQUFNLEVBQUVBLE9BQU9tQixnQkFBZ0IsRUFBRSxHQUFHLE1BQU0vQiw2REFBYUEsQ0FDcERvQixJQUFJLENBQUMsZUFDTFksTUFBTSxDQUFDO1lBQUVQLE1BQU07UUFBSyxHQUNwQkgsRUFBRSxDQUFDLFNBQVNULE9BQ1pTLEVBQUUsQ0FBQyxXQUFXTixLQUFLTyxFQUFFO1FBRXhCLElBQUlRLGtCQUFrQjtZQUNwQkUsUUFBUXJCLEtBQUssQ0FBQyw2QkFBNkJtQjtRQUM3QztRQUVBLE1BQU0vQiw2REFBYUEsQ0FDaEJvQixJQUFJLENBQUMsU0FDTFksTUFBTSxDQUFDO1lBQUVFLGVBQWUsSUFBSVIsT0FBT1MsV0FBVztRQUFHLEdBQ2pEYixFQUFFLENBQUMsTUFBTU4sS0FBS08sRUFBRTtRQUVuQixNQUFNYSxlQUFlaEMseURBQVdBLENBQUM7WUFBRWlDLFFBQVFyQixLQUFLTyxFQUFFO1lBQUVULE9BQU9FLEtBQUtGLEtBQUs7UUFBQztRQUN0RVgsOERBQWdCQSxDQUFDSSxLQUFLNkI7UUFFdEIsT0FBTzdCLElBQUlHLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRTJCLFNBQVM7UUFBSztJQUM5QyxFQUFFLE9BQU8xQixPQUFPO1FBQ2RxQixRQUFRckIsS0FBSyxDQUFDLHVCQUF1QkE7UUFDckMsT0FBT0wsSUFBSUcsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQW9CO0lBQzNEO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90b3R3aXNlLXNlcnZlci8uL3BhZ2VzL2FwaS9hdXRoL3ZlcmlmeS5qcz9hNTI0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHN1cGFiYXNlQWRtaW4gfSBmcm9tICcuLi8uLi8uLi9saWIvc3VwYWJhc2VBZG1pbic7XG5pbXBvcnQgeyBnZXRVc2VyQnlFbWFpbCwgZ2V0QWN0aXZlU3Vic2NyaXB0aW9uIH0gZnJvbSAnLi4vLi4vLi4vbGliL3N1YnNjcmlwdGlvbic7XG5pbXBvcnQgeyBzZXRTZXNzaW9uQ29va2llLCBzaWduU2Vzc2lvbiB9IGZyb20gJy4uLy4uLy4uL2xpYi9zZXNzaW9uJztcblxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXEsIHJlcykge1xuICBpZiAocmVxLm1ldGhvZCAhPT0gJ1BPU1QnKSB7XG4gICAgcmVzLnNldEhlYWRlcignQWxsb3cnLCAnUE9TVCcpO1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNSkuanNvbih7IGVycm9yOiAnTWV0aG9kIG5vdCBhbGxvd2VkJyB9KTtcbiAgfVxuXG4gIGNvbnN0IHsgdG9rZW4sIGVtYWlsIH0gPSByZXEuYm9keSB8fCB7fTtcbiAgaWYgKCF0b2tlbiB8fCAhZW1haWwpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ1VuYWJsZSB0byBzaWduIGluJyB9KTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IGdldFVzZXJCeUVtYWlsKGVtYWlsKTtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAnVW5hYmxlIHRvIHNpZ24gaW4nIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHsgZGF0YTogdG9rZW5Sb3csIGVycm9yOiB0b2tlbkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAuZnJvbSgnYXV0aF90b2tlbnMnKVxuICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAuZXEoJ3Rva2VuJywgdG9rZW4pXG4gICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VyLmlkKVxuICAgICAgLm1heWJlU2luZ2xlKCk7XG5cbiAgICBpZiAodG9rZW5FcnJvciB8fCAhdG9rZW5Sb3cpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAnVW5hYmxlIHRvIHNpZ24gaW4nIH0pO1xuICAgIH1cblxuICAgIGlmICh0b2tlblJvdy51c2VkKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ1VuYWJsZSB0byBzaWduIGluJyB9KTtcbiAgICB9XG5cbiAgICBpZiAobmV3IERhdGUodG9rZW5Sb3cuZXhwaXJlc19hdCkuZ2V0VGltZSgpIDwgRGF0ZS5ub3coKSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdVbmFibGUgdG8gc2lnbiBpbicgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgYWN0aXZlU3ViID0gYXdhaXQgZ2V0QWN0aXZlU3Vic2NyaXB0aW9uKHVzZXIuaWQpO1xuICAgIGlmICghYWN0aXZlU3ViKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBlcnJvcjogJ1VuYWJsZSB0byBzaWduIGluJyB9KTtcbiAgICB9XG5cbiAgICBjb25zdCB7IGVycm9yOiB1cGRhdGVUb2tlbkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAuZnJvbSgnYXV0aF90b2tlbnMnKVxuICAgICAgLnVwZGF0ZSh7IHVzZWQ6IHRydWUgfSlcbiAgICAgIC5lcSgndG9rZW4nLCB0b2tlbilcbiAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXIuaWQpO1xuXG4gICAgaWYgKHVwZGF0ZVRva2VuRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1thdXRoXSB0b2tlbiB1cGRhdGUgZXJyb3InLCB1cGRhdGVUb2tlbkVycm9yKTtcbiAgICB9XG5cbiAgICBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAuZnJvbSgndXNlcnMnKVxuICAgICAgLnVwZGF0ZSh7IGxhc3RfbG9naW5fYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSB9KVxuICAgICAgLmVxKCdpZCcsIHVzZXIuaWQpO1xuXG4gICAgY29uc3Qgc2Vzc2lvblRva2VuID0gc2lnblNlc3Npb24oeyB1c2VySWQ6IHVzZXIuaWQsIGVtYWlsOiB1c2VyLmVtYWlsIH0pO1xuICAgIHNldFNlc3Npb25Db29raWUocmVzLCBzZXNzaW9uVG9rZW4pO1xuXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgc3VjY2VzczogdHJ1ZSB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbYXV0aF0gdmVyaWZ5IGVycm9yJywgZXJyb3IpO1xuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnVW5hYmxlIHRvIHNpZ24gaW4nIH0pO1xuICB9XG59XG4iXSwibmFtZXMiOlsic3VwYWJhc2VBZG1pbiIsImdldFVzZXJCeUVtYWlsIiwiZ2V0QWN0aXZlU3Vic2NyaXB0aW9uIiwic2V0U2Vzc2lvbkNvb2tpZSIsInNpZ25TZXNzaW9uIiwiaGFuZGxlciIsInJlcSIsInJlcyIsIm1ldGhvZCIsInNldEhlYWRlciIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsInRva2VuIiwiZW1haWwiLCJib2R5IiwidXNlciIsImRhdGEiLCJ0b2tlblJvdyIsInRva2VuRXJyb3IiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJpZCIsIm1heWJlU2luZ2xlIiwidXNlZCIsIkRhdGUiLCJleHBpcmVzX2F0IiwiZ2V0VGltZSIsIm5vdyIsImFjdGl2ZVN1YiIsInVwZGF0ZVRva2VuRXJyb3IiLCJ1cGRhdGUiLCJjb25zb2xlIiwibGFzdF9sb2dpbl9hdCIsInRvSVNPU3RyaW5nIiwic2Vzc2lvblRva2VuIiwidXNlcklkIiwic3VjY2VzcyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/auth/verify.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth%2Fverify&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fauth%2Fverify.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();