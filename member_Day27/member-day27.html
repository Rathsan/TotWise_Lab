<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 27 â€” TotWise Lab</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=DM+Sans:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/member_Day1/member.css">
    <script src="/auth/auth.js"></script>
    <!-- Soft Day-Locking -->
    <script src="/soft-day-lock.js"></script>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="brand">
                <svg class="brand-icon" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="16" cy="16" r="14" fill="#E8B4A0"/>
                    <circle cx="11" cy="13" r="2.5" fill="#2D3B3A"/>
                    <circle cx="21" cy="13" r="2.5" fill="#2D3B3A"/>
                    <path d="M11 21 Q16 26 21 21" stroke="#2D3B3A" stroke-width="2" stroke-linecap="round" fill="none"/>
                </svg>
                <div class="brand-text">
                    <span class="brand-name">TotWise Lab</span>
                    <span class="toolkit-label">2â€“3 Years Toolkit</span>
                </div>
            </div>
            <button class="logout-btn">Log out</button>
        </header>

        <main class="content">
            <section class="day-header-card">
                <div class="day-info">
                    <div class="info-item">
                        <svg class="info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 6v6l4 2"/>
                        </svg>
                        <span>10â€“15 minutes</span>
                    </div>
                    <div class="info-item">
                        <svg class="info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2a4 4 0 0 1 4 4c0 1.5-.8 2.8-2 3.5V11h-4V9.5A4 4 0 0 1 12 2z"/>
                            <path d="M8 14h8M9 18h6M10 22h4"/>
                        </svg>
                        <span>Independent Play (Nearby)</span>
                    </div>
                    <div class="info-item materials">
                        <svg class="info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                        </svg>
                        <span>Toys nearby</span>
                    </div>
                </div>
            </section>

            <section class="activity-card">
                <div class="card-header">
                    <span class="card-emoji">ðŸ§¸</span>
                    <h2>Today's Play: "Play Near Me"</h2>
                </div>

                <div class="activity-section">
                    <h3>
                        <svg class="section-icon" viewBox="0 0 20 20" fill="currentColor">
                            <circle cx="10" cy="10" r="8" fill="#E8B4A0" opacity="0.2"/>
                            <path d="M7 10l2 2 4-4" stroke="#E8B4A0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        How to Play
                        <span class="time-badge">5â€“10 minutes</span>
                    </h3>
                    <ul class="step-list">
                        <li>Sit nearby</li>
                        <li>Let child play alone</li>
                        <li>Say: "I'm here."</li>
                    </ul>
                </div>

                <div class="activity-section what-to-say">
                    <h3>
                        <svg class="section-icon" viewBox="0 0 20 20" fill="currentColor">
                            <circle cx="10" cy="10" r="8" fill="#F5D5C8" opacity="0.3"/>
                            <path d="M7 8h6M7 12h4" stroke="#D9A592" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        What You Say
                    </h3>
                    <div class="speech-bubbles">
                        <div class="speech-bubble">
                            <span>"You're playing."</span>
                        </div>
                        <div class="speech-bubble">
                            <span>"I'm here."</span>
                        </div>
                    </div>
                </div>
            </section>

            <section class="worksheet-card">
                <div class="card-header small">
                    <span class="card-emoji">ðŸ–¨</span>
                    <h3>Optional Worksheet</h3>
                </div>
                <p class="worksheet-desc">Play on your own. Watching or trying is enough.</p>
                <p class="gentle-note">
                    <svg viewBox="0 0 20 20" fill="none">
                        <circle cx="10" cy="10" r="8" stroke="#A8C5A0" stroke-width="1.5"/>
                        <path d="M10 7v3M10 13h.01" stroke="#A8C5A0" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    If your child isn't interested today, you can skip this.
                </p>
                <a href="/member_Day27/day27-worksheet.html" target="_blank" class="worksheet-link">
                    <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M4 16v1a2 2 0 002 2h8a2 2 0 002-2v-1M12 11l-2 2-2-2M10 3v10"/>
                    </svg>
                    Download Worksheet
                </a>
            </section>

            <section class="script-card">
                <div class="card-header small">
                    <span class="card-emoji">ðŸ’¬</span>
                    <h3>If This Happens...</h3>
                </div>
                
                <div class="situation">
                    <p class="situation-text">Your child wants you to play or comes back frequently</p>
                </div>

                <div class="script-comparison">
                    <div class="script-avoid">
                        <div class="script-label">
                            <svg viewBox="0 0 20 20" fill="none">
                                <circle cx="10" cy="10" r="8" fill="#FFE5E5"/>
                                <path d="M7 7l6 6M13 7l-6 6" stroke="#D98888" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            <span>Avoid saying</span>
                        </div>
                        <p class="script-text">"Play by yourself."</p>
                    </div>
                    
                    <div class="script-better">
                        <div class="script-label">
                            <svg viewBox="0 0 20 20" fill="none">
                                <circle cx="10" cy="10" r="8" fill="#E8F5E8"/>
                                <path d="M7 10l2 2 4-4" stroke="#6AAF6A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span>Say this instead</span>
                        </div>
                        <p class="script-text">"I'm nearby."</p>
                    </div>
                </div>
            </section>

            <section class="emotional-card">
                <div class="card-header small">
                    <span class="card-emoji">ðŸ’›</span>
                    <h3>Emotional Tool â€” Name Independence</h3>
                </div>
                
                <div class="emotional-content">
                    <div class="emotional-illustration">
                        <svg viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="40" cy="40" r="35" fill="#FFF8F5"/>
                            <circle cx="40" cy="38" r="22" fill="#FFE5D9"/>
                            <circle cx="33" cy="34" r="3" fill="#2D3B3A"/>
                            <circle cx="47" cy="34" r="3" fill="#2D3B3A"/>
                            <path d="M34 46 Q40 52 46 46" stroke="#2D3B3A" stroke-width="2.5" stroke-linecap="round" fill="none"/>
                            <circle cx="26" cy="38" r="4" fill="#F5D5C8"/>
                            <circle cx="54" cy="38" r="4" fill="#F5D5C8"/>
                            <path d="M18 20 L19 23 L22 24 L19 25 L18 28 L17 25 L14 24 L17 23 Z" fill="#A8C5A0"/>
                            <path d="M62 18 L63 20 L65 21 L63 22 L62 24 L61 22 L59 21 L61 20 Z" fill="#E8B4A0"/>
                        </svg>
                    </div>
                    <div class="emotional-text">
                        <p>Name independence gently.</p>
                    </div>
                </div>
            </section>

            <section class="reassurance-strip">
                <div class="reassurance-icon">
                    <svg viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M16 4 L18 12 L26 14 L18 16 L16 24 L14 16 L6 14 L14 12 Z" fill="#A8C5A0"/>
                        <circle cx="16" cy="14" r="3" fill="white"/>
                    </svg>
                </div>
                <div class="reassurance-text">
                    <p class="reassurance-title">You're building:</p>
                    <p class="reassurance-skills">Confidence and independence.</p>
                    <p class="reassurance-note">Independence grows with safety.</p>
                </div>
            </section>

            <section class="completion-section">
                <button class="complete-btn" id="completeBtn">
                    <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                        <path d="M5 13l4 4L19 7"/>
                    </svg>
                    <span id="completeBtnText">Mark Today as Complete</span>
                </button>
            </section>
        </main>

        <div class="completion-overlay" id="completionOverlay">
            <div class="completion-modal">
                <div class="completion-celebration">
                    <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="50" cy="50" r="45" fill="#A8C5A0"/>
                        <path d="M30 50l12 12 28-28" stroke="white" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <h2>Lovely work today!</h2>
                <p>You did something wonderful for your child.</p>
                <p class="completion-next">Day-28 will be ready when you are.</p>
                <button class="modal-close-btn" id="closeModalBtn">Done</button>
            </div>
        </div>
    </div>

    <script>
        (function() {
            if (typeof TotWiseAuth === 'undefined') {
                const token = sessionStorage.getItem('loginToken');
                if (!token) {
                    const protocol = window.location.protocol;
                    const pathname = window.location.pathname;
                    if (protocol === 'http:' || protocol === 'https:') {
                        const basePath = pathname.split('/member_Day')[0];
                        window.location.href = basePath + '/login/login.html';
                    } else {
                        window.location.href = '../login/login.html';
                    }
                    return;
                }
            } else {
                TotWiseAuth.initAuth({ checkURLToken: false, requireAuth: true });
            }
        })();

        function getCurrentDay() {
            const pathname = window.location.pathname;
            const match = pathname.match(/member-day(\d+)\.html/);
            return match ? parseInt(match[1]) : 27;
        }

        const currentDay = getCurrentDay();

        // Check and apply soft day-locking if needed
        if (typeof TotWiseSoftLock !== 'undefined') {
            TotWiseSoftLock.checkAndApply(currentDay);
        }
        const completeBtn = document.getElementById('completeBtn');
        const completionOverlay = document.getElementById('completionOverlay');
        const closeModalBtn = document.getElementById('closeModalBtn');

        completeBtn.addEventListener('click', function() {
            this.classList.add('completed');
            this.innerHTML = `<svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M5 13l4 4L19 7"/></svg><span>Completed</span>`;
            setTimeout(() => { completionOverlay.classList.add('show'); }, 300);
        });

        function handleCompletion() {
            completionOverlay.classList.remove('show');
            const completedDays = JSON.parse(localStorage.getItem('totwise.progress.completedDays') || '[]');
            if (!completedDays.includes(currentDay)) {
                completedDays.push(currentDay);
                localStorage.setItem('totwise.progress.completedDays', JSON.stringify(completedDays));
            }
            const protocol = window.location.protocol;
            const pathname = window.location.pathname;
            if (protocol === 'http:' || protocol === 'https:') {
                const basePath = pathname.split('/member_Day')[0];
                window.location.href = basePath + '/Dashboard/dashboard.html';
            } else {
                window.location.href = '../Dashboard/dashboard.html';
            }
        }

        closeModalBtn.addEventListener('click', handleCompletion);
        completionOverlay.addEventListener('click', function(e) {
            if (e.target === completionOverlay) handleCompletion();
        });

        const logoutBtn = document.querySelector('.logout-btn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function() {
                if (typeof TotWiseAuth !== 'undefined') {
                    TotWiseAuth.logout();
                } else {
                    sessionStorage.removeItem('loginToken');
                    sessionStorage.removeItem('userEmail');
                    const protocol = window.location.protocol;
                    const pathname = window.location.pathname;
                    if (protocol === 'http:' || protocol === 'https:') {
                        const basePath = pathname.split('/member_Day')[0];
                        window.location.href = basePath + '/login/login.html';
                    } else {
                        window.location.href = '../login/login.html';
                    }
                }
            });
        }
    </script>
</body>
</html>
