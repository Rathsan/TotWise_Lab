<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 12 ‚Äî TotWise Lab</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=DM+Sans:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/member_Day1/member.css">
    <script src="/auth/auth.js"></script>
    <!-- Soft Day-Locking -->
    <script src="/js/totwise-core.js"></script>
    <script src="/soft-day-lock.js"></script>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="brand">
                <svg class="brand-icon" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="16" cy="16" r="14" fill="#E8B4A0"/>
                    <circle cx="11" cy="13" r="2.5" fill="#2D3B3A"/>
                    <circle cx="21" cy="13" r="2.5" fill="#2D3B3A"/>
                    <path d="M11 21 Q16 26 21 21" stroke="#2D3B3A" stroke-width="2" stroke-linecap="round" fill="none"/>
                </svg>
                <div class="brand-text">
                    <span class="brand-name">TotWise Lab</span>
                    <span class="toolkit-label">2‚Äì3 Years Toolkit</span>
                </div>
            </div>
            <button class="logout-btn">Log out</button>
        </header>

        <main class="content">
            <section class="day-header-card">
                <div class="day-info">
                    <div class="info-item">
                        <svg class="info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 6v6l4 2"/>
                        </svg>
                        <span>10‚Äì15 minutes</span>
                    </div>
                    <div class="info-item">
                        <svg class="info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2a4 4 0 0 1 4 4c0 1.5-.8 2.8-2 3.5V11h-4V9.5A4 4 0 0 1 12 2z"/>
                            <path d="M8 14h8M9 18h6M10 22h4"/>
                        </svg>
                        <span>Naming Emotions (Basic)</span>
                    </div>
                    <div class="info-item materials">
                        <svg class="info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                        </svg>
                        <span>Your face</span>
                    </div>
                </div>
            </section>

            <section class="activity-card">
                <div class="card-header">
                    <span class="card-emoji">üß∏</span>
                    <h2>Today's Play: "How Do You Feel?"</h2>
                </div>

                <div class="activity-section">
                    <h3>
                        <svg class="section-icon" viewBox="0 0 20 20" fill="currentColor">
                            <circle cx="10" cy="10" r="8" fill="#E8B4A0" opacity="0.2"/>
                            <path d="M7 10l2 2 4-4" stroke="#E8B4A0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        How to Play
                        <span class="time-badge">5‚Äì10 minutes</span>
                    </h3>
                    <ul class="step-list">
                        <li>Show face</li>
                        <li>Say: "Happy."</li>
                        <li>Mirror expression</li>
                    </ul>
                </div>

                <div class="activity-section what-to-say">
                    <h3>
                        <svg class="section-icon" viewBox="0 0 20 20" fill="currentColor">
                            <circle cx="10" cy="10" r="8" fill="#F5D5C8" opacity="0.3"/>
                            <path d="M7 8h6M7 12h4" stroke="#D9A592" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        What You Say
                    </h3>
                    <div class="speech-bubbles">
                        <div class="speech-bubble">
                            <span>"Happy."</span>
                        </div>
                        <div class="speech-bubble">
                            <span>"You look happy."</span>
                        </div>
                    </div>
                </div>
            </section>

            <section class="worksheet-card">
                <div class="card-header small">
                    <span class="card-emoji">üñ®</span>
                    <h3>Optional Worksheet</h3>
                </div>
                <p class="worksheet-desc">Look at the faces. Pointing or watching is enough.</p>
                <p class="gentle-note">
                    <svg viewBox="0 0 20 20" fill="none">
                        <circle cx="10" cy="10" r="8" stroke="#A8C5A0" stroke-width="1.5"/>
                        <path d="M10 7v3M10 13h.01" stroke="#A8C5A0" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    If your child isn't interested today, you can skip this.
                </p>
                <a href="/member_Day12/day12-worksheet.html" target="_blank" class="worksheet-link">
                    <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M4 16v1a2 2 0 002 2h8a2 2 0 002-2v-1M12 11l-2 2-2-2M10 3v10"/>
                    </svg>
                    Download Worksheet
                </a>
            </section>

            <section class="reassurance-strip">
                <div class="reassurance-icon">
                    <svg viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M16 4 L18 12 L26 14 L18 16 L16 24 L14 16 L6 14 L14 12 Z" fill="#A8C5A0"/>
                        <circle cx="16" cy="14" r="3" fill="white"/>
                    </svg>
                </div>
                <div class="reassurance-text">
                    <p class="reassurance-title">You're building:</p>
                    <p class="reassurance-skills">Emotion recognition and regulation.</p>
                    <p class="reassurance-note">Naming feelings builds calm.</p>
                </div>
            </section>

            <section class="completion-section">
                <button class="complete-btn" id="completeBtn">
                    <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                        <path d="M5 13l4 4L19 7"/>
                    </svg>
                    <span id="completeBtnText">Mark Today as Complete</span>
                </button>
            </section>
        </main>

        <div class="completion-overlay" id="completionOverlay">
            <div class="completion-modal">
                <div class="completion-celebration">
                    <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="50" cy="50" r="45" fill="#A8C5A0"/>
                        <path d="M30 50l12 12 28-28" stroke="white" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <h2>Lovely work today!</h2>
                <p>You did something wonderful for your child.</p>
                <p class="completion-next">Day-13 will be ready when you are.</p>
                <button class="modal-close-btn" id="closeModalBtn">Done</button>
            </div>
        </div>
    </div>

            <script>
        // Authentication check - require login to access Day pages
        (function() {
            // Wait for auth.js to load
            if (typeof TotWiseAuth === 'undefined') {
                // If auth.js didn't load, check manually
                const token = sessionStorage.getItem('loginToken');
                if (!token) {
                    console.log('‚ùå Not authenticated, redirecting to login');
                    const protocol = window.location.protocol;
                    const pathname = window.location.pathname;
                    
                    if (protocol === 'http:' || protocol === 'https:') {
                        const basePath = pathname.split('/member_Day')[0];
                        window.location.href = basePath + '/login/login.html';
                    } else {
                        window.location.href = '../login/login.html';
                    }
                    return;
                }
            } else {
                // Use centralized auth
                TotWiseAuth.initAuth({ checkURLToken: false, requireAuth: true });
            }
        })();

        // Get current day number from URL or default to 12
        function getCurrentDay() {
            const pathname = window.location.pathname;
            const match = pathname.match(/member-day(\d+)\.html/);
            return match ? parseInt(match[1]) : 12;
        }

        const currentDay = getCurrentDay();

        (function initDayPage() {
            TotWiseCore.getProgressState();

            function getDashboardPath() {
                const protocol = window.location.protocol;
                const pathname = window.location.pathname;
                if (protocol === 'http:' || protocol === 'https:') {
                    const basePath = pathname.split('/member_Day')[0];
                    return basePath + '/Dashboard/dashboard.html';
                }
                return '../Dashboard/dashboard.html';
            }

            function redirectToDashboard() {
                window.location.href = getDashboardPath();
            }

            function setupLogout() {
                const logoutBtn = document.querySelector('.logout-btn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', function() {
                        if (typeof TotWiseAuth !== 'undefined') {
                            TotWiseAuth.logout();
                        } else {
                            sessionStorage.removeItem('loginToken');
                            sessionStorage.removeItem('userEmail');
                            const protocol = window.location.protocol;
                            const pathname = window.location.pathname;
                            if (protocol === 'http:' || protocol === 'https:') {
                                const basePath = pathname.split('/member_Day')[0];
                                window.location.href = basePath + '/login/login.html';
                            } else {
                                window.location.href = '../login/login.html';
                            }
                        }
                    });
                }
            }

            function onCompleteClick() {
                if (TotWiseCore.isFutureDay(currentDay)) {
                    if (typeof TotWiseSoftLock !== 'undefined') {
                        TotWiseSoftLock.showCompletionBlockedModal(currentDay);
                    }
                    return;
                }

                TotWiseCore.markTodayComplete(currentDay);
            }

            function attachCompletionHandler() {
                const completeBtn = document.getElementById('completeBtn');
                const completionOverlay = document.getElementById('completionOverlay');
                const closeModalBtn = document.getElementById('closeModalBtn');

                if (!completeBtn || !completionOverlay || !closeModalBtn) {
                    return;
                }

                completeBtn.addEventListener('click', function() {
                    onCompleteClick();
                    if (TotWiseCore.isFutureDay(currentDay)) {
                        return;
                    }

                    this.classList.add('completed');
                    this.innerHTML = `
                        <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                            <path d="M5 13l4 4L19 7"/>
                        </svg>
                        <span>Completed</span>
                    `;

                    setTimeout(() => {
                        completionOverlay.classList.add('show');
                    }, 300);
                });

                function handleCompletion() {
                    onCompleteClick();
                    if (TotWiseCore.isFutureDay(currentDay)) {
                        return;
                    }

                    completionOverlay.classList.remove('show');

                    redirectToDashboard();
                }

                closeModalBtn.addEventListener('click', handleCompletion);
                completionOverlay.addEventListener('click', function(e) {
                    if (e.target === completionOverlay) {
                        handleCompletion();
                    }
                });
            }

            attachCompletionHandler();
            setupLogout();
        })();
    </script>


</body>
</html>
