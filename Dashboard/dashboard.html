<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Dashboard â€” TotWise Lab</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=DM+Sans:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="dashboard.css">
</head>
<body>
    <div class="app-container">
        <!-- Minimal Header -->
        <header class="app-header">
            <div class="brand">
                <svg class="brand-icon" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="16" cy="16" r="14" fill="#E8B4A0"/>
                    <circle cx="11" cy="13" r="2.5" fill="#2D3B3A"/>
                    <circle cx="21" cy="13" r="2.5" fill="#2D3B3A"/>
                    <path d="M11 21 Q16 26 21 21" stroke="#2D3B3A" stroke-width="2" stroke-linecap="round" fill="none"/>
                </svg>
                <div class="brand-text">
                    <span class="brand-name">TotWise Lab</span>
                    <span class="toolkit-label">2â€“3 Years Toolkit</span>
                </div>
            </div>
            <button class="logout-btn">Log out</button>
        </header>

        <main class="content">
            <!-- Welcome Strip -->
            <section class="welcome-strip">
                <div class="welcome-content">
                    <span class="welcome-wave">ðŸ‘‹</span>
                    <div class="welcome-text">
                        <p class="welcome-greeting" id="welcomeGreeting">Hi There</p>
                        <p class="welcome-message">You're doing great. Let's focus on today.</p>
                    </div>
                </div>
            </section>

            <!-- Today's Focus Card -->
            <section class="today-card">
                <div class="today-badge">
                    <svg viewBox="0 0 20 20" fill="none">
                        <circle cx="10" cy="10" r="8" fill="#A8C5A0"/>
                        <circle cx="10" cy="10" r="4" fill="white"/>
                    </svg>
                    <span>Today's Focus</span>
                </div>

                <div class="today-header">
                    <div class="day-indicator">
                        <span class="day-label">Day</span>
                        <span class="day-number">1</span>
                        <span class="day-total">of 30</span>
                    </div>
                    <div class="today-details">
                        <div class="detail-item">
                            <svg class="detail-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2a4 4 0 0 1 4 4c0 1.5-.8 2.8-2 3.5V11h-4V9.5A4 4 0 0 1 12 2z"/>
                                <path d="M8 14h8M9 18h6M10 22h4"/>
                            </svg>
                            <span>Language & Attention</span>
                        </div>
                        <div class="detail-item">
                            <svg class="detail-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 6v6l4 2"/>
                            </svg>
                            <span>10â€“15 minutes</span>
                        </div>
                    </div>
                </div>

                <div class="today-activity">
                    <div class="activity-preview">
                        <span class="activity-emoji">ðŸ§¸</span>
                        <div class="activity-info">
                            <h3>Talk & Drop</h3>
                            <p>A simple game to build vocabulary and hand-eye coordination</p>
                        </div>
                    </div>
                </div>

                <a href="/member_Day1/member-day1.html" class="start-btn">
                    <span>Start Day 1</span>
                    <svg class="btn-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                </a>
            </section>

            <!-- 30-Day Journey -->
            <section class="journey-section">
                <div class="journey-header">
                    <h2>Your 30-Day Journey</h2>
                    <p class="journey-subtitle">One activity at a time. No rush.</p>
                </div>

                <div class="days-grid" id="daysGrid">
                    <!-- Day 1 - Active -->
                    <button class="day-pill active" data-day="1">
                        <span class="day-num">1</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <circle cx="8" cy="8" r="6" fill="#A8C5A0"/>
                                <circle cx="8" cy="8" r="3" fill="white"/>
                            </svg>
                        </span>
                    </button>
                    
                    <!-- Days 2-30 - Locked -->
                    <button class="day-pill locked" data-day="2">
                        <span class="day-num">2</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="3">
                        <span class="day-num">3</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="4">
                        <span class="day-num">4</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="5">
                        <span class="day-num">5</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="6">
                        <span class="day-num">6</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="7">
                        <span class="day-num">7</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="8">
                        <span class="day-num">8</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="9">
                        <span class="day-num">9</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="10">
                        <span class="day-num">10</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="11">
                        <span class="day-num">11</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="12">
                        <span class="day-num">12</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="13">
                        <span class="day-num">13</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="14">
                        <span class="day-num">14</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="15">
                        <span class="day-num">15</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="16">
                        <span class="day-num">16</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="17">
                        <span class="day-num">17</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="18">
                        <span class="day-num">18</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="19">
                        <span class="day-num">19</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="20">
                        <span class="day-num">20</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="21">
                        <span class="day-num">21</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="22">
                        <span class="day-num">22</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="23">
                        <span class="day-num">23</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="24">
                        <span class="day-num">24</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="25">
                        <span class="day-num">25</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="26">
                        <span class="day-num">26</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="27">
                        <span class="day-num">27</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="28">
                        <span class="day-num">28</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="29">
                        <span class="day-num">29</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                    <button class="day-pill locked" data-day="30">
                        <span class="day-num">30</span>
                        <span class="day-status">
                            <svg viewBox="0 0 16 16" fill="none">
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                        </span>
                    </button>
                </div>
            </section>

            <!-- Progress Section -->
            <section class="progress-section">
                <div class="progress-content">
                    <div class="progress-icon">
                        <svg viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="16" cy="16" r="14" fill="#A8C5A0" opacity="0.2"/>
                            <path d="M10 16l4 4 8-8" stroke="#7BA876" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="progress-text">
                        <p class="progress-count">0 of 30 days completed</p>
                        <p class="progress-note">Consistency matters more than perfection.</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Soft Lock Modal -->
    <div class="locked-modal" id="lockedModal">
        <div class="locked-modal-content">
            <h2 class="locked-modal-title">This will be ready tomorrow</h2>
            <p class="locked-modal-text">Today is about one calm moment.</p>
            <p class="locked-modal-text">You don't need to rush ahead.</p>
            <div class="locked-modal-actions">
                <button class="locked-modal-primary" id="backToTodayBtn">Back to Today</button>
            </div>
            <button class="locked-modal-close" id="closeLockedModal">Close</button>
        </div>
    </div>

    <!-- Centralized Authentication -->
    <script src="/auth/auth.js"></script>

    <script>
        // Helper function to get the correct login page path (kept for backward compatibility)
        function getLoginPath() {
            if (typeof TotWiseAuth !== 'undefined') {
                return TotWiseAuth.getLoginPath();
            }
            
            const protocol = window.location.protocol;
            const pathname = window.location.pathname;
            
            if (protocol === 'http:' || protocol === 'https:') {
                const basePath = pathname.split('/Dashboard')[0];
                return basePath + '/login/login.html';
            }
            
            return '../login/login.html';
        }

        // Function to update welcome greeting
        // Using "Hi There" for a warm, consistent greeting that works for everyone
        function updateWelcomeGreeting() {
            const greetingElement = document.getElementById('welcomeGreeting');
            if (greetingElement) {
                greetingElement.textContent = 'Hi There';
            }
        }

        // Authentication check using centralized auth
        (function() {
            // Wait for auth.js to load, then use centralized auth
            if (typeof TotWiseAuth !== 'undefined') {
                TotWiseAuth.initAuth({ checkURLToken: true, requireAuth: true });
            } else {
                // Fallback if auth.js didn't load - use manual check
                console.warn('Auth.js not loaded, using fallback authentication');
                const token = sessionStorage.getItem('loginToken');
                if (!token) {
                    window.location.href = getLoginPath();
                }
            }
            
            // Update welcome greeting after auth check
            updateWelcomeGreeting();
        })();

        // Function to update dashboard based on completed days
        function updateDashboard() {
            // Get completed days from localStorage (using new key naming)
            const completedDays = JSON.parse(localStorage.getItem('totwise.progress.completedDays') || '[]');
            console.log('Completed days:', completedDays);
            
            // Calculate current day (next unlocked day)
            const currentDay = completedDays.length > 0 ? Math.max(...completedDays) + 1 : 1;
            const currentDayLimited = Math.min(currentDay, 30); // Cap at 30
            
            // Update progress count
            const progressCount = document.querySelector('.progress-count');
            if (progressCount) {
                progressCount.textContent = `${completedDays.length} of 30 days completed`;
            }
            
            // Update "Today's Focus" section
            const dayNumber = document.querySelector('.day-number');
            if (dayNumber) {
                dayNumber.textContent = currentDayLimited;
            }
            
            // Update "Start Day X" button with dynamic routing
            const startBtn = document.querySelector('.start-btn');
            if (startBtn) {
                const btnText = startBtn.querySelector('span');
                if (btnText) {
                    btnText.textContent = `Start Day ${currentDayLimited}`;
                    // Dynamic routing - works for all days (even if pages don't exist yet)
                    startBtn.href = `/member_Day${currentDayLimited}/member-day${currentDayLimited}.html`;
                }
            }
            
            // Update activity preview for Day 2 (when Day 1 is completed)
            if (currentDayLimited === 2 && completedDays.includes(1)) {
                const activityEmoji = document.querySelector('.activity-emoji');
                const activityTitle = document.querySelector('.activity-info h3');
                const activityDesc = document.querySelector('.activity-info p');
                
                if (activityEmoji) activityEmoji.textContent = 'ðŸŽ¨'; // Update with Day 2 emoji
                if (activityTitle) activityTitle.textContent = 'Day 2 Activity'; // Update with Day 2 title
                if (activityDesc) activityDesc.textContent = 'Day 2 description will appear here'; // Update with Day 2 description
            }
            
            // Update calendar days
            const daysGrid = document.getElementById('daysGrid');
            if (daysGrid) {
                const dayPills = daysGrid.querySelectorAll('.day-pill');
                
                dayPills.forEach((pill, index) => {
                    const dayNum = index + 1;
                    const dayNumSpan = pill.querySelector('.day-num');
                    
                    // Remove all status classes
                    pill.classList.remove('active', 'locked', 'completed');
                    
                    if (completedDays.includes(dayNum)) {
                        // Day is completed
                        pill.classList.add('completed');
                        pill.classList.remove('locked');
                        const statusSvg = pill.querySelector('.day-status svg');
                        if (statusSvg) {
                            statusSvg.innerHTML = `
                                <circle cx="8" cy="8" r="6" fill="#A8C5A0"/>
                                <path d="M5 8l2 2 4-4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            `;
                        }
                    } else if (dayNum === currentDayLimited && dayNum <= 30) {
                        // Current day - active (unlocked)
                        pill.classList.add('active');
                        pill.classList.remove('locked');
                        const statusSvg = pill.querySelector('.day-status svg');
                        if (statusSvg) {
                            statusSvg.innerHTML = `
                                <circle cx="8" cy="8" r="6" fill="#A8C5A0"/>
                                <circle cx="8" cy="8" r="3" fill="white"/>
                            `;
                        }
                    } else if (dayNum < currentDayLimited) {
                        // Past days that weren't completed (shouldn't happen, but handle it)
                        pill.classList.add('locked');
                    } else {
                        // Future days - locked
                        pill.classList.add('locked');
                        const statusSvg = pill.querySelector('.day-status svg');
                        if (statusSvg) {
                            statusSvg.innerHTML = `
                                <rect x="4" y="7" width="8" height="6" rx="1.5" fill="currentColor"/>
                                <path d="M6 7V5a2 2 0 114 0v2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            `;
                        }
                    }
                });
            }
        }
        
        // Function to get current unlocked day
        function getCurrentUnlockedDay() {
            const completedDays = JSON.parse(localStorage.getItem('totwise.progress.completedDays') || '[]');
            const currentDay = completedDays.length > 0 ? Math.max(...completedDays) + 1 : 1;
            return Math.min(currentDay, 30); // Cap at 30
        }

        // Update dashboard and greeting on page load
        updateDashboard();
        updateWelcomeGreeting();

        const lockedModal = document.getElementById('lockedModal');
        const closeLockedModal = document.getElementById('closeLockedModal');
        const backToTodayBtn = document.getElementById('backToTodayBtn');
        const daysGrid = document.getElementById('daysGrid');

        // Handle day clicks
        daysGrid.addEventListener('click', function(e) {
            const dayPill = e.target.closest('.day-pill');
            if (dayPill) {
                const dayNum = parseInt(dayPill.getAttribute('data-day'));
                const currentUnlockedDay = getCurrentUnlockedDay();
                
                // Soft day-locking: prevent accessing future days
                if (dayNum > currentUnlockedDay) {
                    // Show soft lock modal for future days
                    lockedModal.classList.add('show');
                    return;
                }
                
                if (dayPill.classList.contains('locked')) {
                    // Show locked modal for locked days (shouldn't happen with soft locking, but keep for safety)
                    lockedModal.classList.add('show');
                } else if (dayPill.classList.contains('active')) {
                    // Active day - navigate to that day's page using dynamic routing
                    window.location.href = `/member_Day${dayNum}/member-day${dayNum}.html`;
                } else if (dayPill.classList.contains('completed')) {
                    // Completed day - navigate to that day's page (for review)
                    window.location.href = `/member_Day${dayNum}/member-day${dayNum}.html`;
                }
            }
        });

        // Back to Today button
        if (backToTodayBtn) {
            backToTodayBtn.addEventListener('click', function() {
                lockedModal.classList.remove('show');
                const currentUnlockedDay = getCurrentUnlockedDay();
                window.location.href = `/member_Day${currentUnlockedDay}/member-day${currentUnlockedDay}.html`;
            });
        }

        // Close modal
        closeLockedModal.addEventListener('click', function() {
            lockedModal.classList.remove('show');
        });

        lockedModal.addEventListener('click', function(e) {
            if (e.target === lockedModal) {
                lockedModal.classList.remove('show');
            }
        });

        // Close on escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && lockedModal.classList.contains('show')) {
                lockedModal.classList.remove('show');
            }
        });

        // Handle logout using centralized auth
        const logoutBtn = document.querySelector('.logout-btn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function() {
                if (typeof TotWiseAuth !== 'undefined') {
                    TotWiseAuth.logout();
                } else {
                    // Fallback if auth.js didn't load
                    sessionStorage.removeItem('loginToken');
                    sessionStorage.removeItem('userEmail');
                    window.location.href = getLoginPath();
                }
            });
        }
    </script>
</body>
</html>
